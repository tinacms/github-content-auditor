name: Audit Content with AI

on:
  workflow_dispatch:

permissions:
  models: read

jobs: 
  lists-posts:
    runs-on: ubuntu-latest
    outputs:
      file-list: ${{ steps.list-posts.outputs.FILE_LIST }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Build file list
        id: list-posts
        run: | 
          FILES="["
          FIRST=true
          for file in content/posts/*.mdx; do
            if [ "$FIRST" = true ]; then
              FILES="${FILES}\"$(basename $file)\""
              FIRST=false
            else
              FILES="${FILES},\"$(basename $file)\""
            fi
          done
          FILES="${FILES}]"
          echo "FILE_LIST=$FILES" >> $GITHUB_OUTPUT
  echo-posts:
    needs: lists-posts
    runs-on: ubuntu-latest
    strategy:
      matrix:
        file: ${{ fromJson(needs.lists-posts.outputs.file-list) }}
    steps:
      - name: Echo all Posts
        run: |
              echo "Processing file: ${{ matrix.file }}"